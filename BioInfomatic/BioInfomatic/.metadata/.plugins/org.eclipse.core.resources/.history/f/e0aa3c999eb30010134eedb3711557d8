package com.bio.algorithm;


import com.bio.model.MatchResult;
import java.util.ArrayList;
import java.util.List;
import java.util.Arrays;


//... (imports remain the same)

public class BoyerMooreSearch {

 // NEW FIELD: Comparison counter
 private long comparisonCount = 0;
 
 // ... (buildBadCharTable method remains the same)

 public MatchResult search(String text, String pattern) {
     List<Integer> matchIndices = new ArrayList<>();
     int N = text.length();
     int M = pattern.length();
     
     if (M == 0 || N == 0 || M > N) {
         // NEW: Return 0 for comparisonCount and overheadNs
         return new MatchResult("Boyer-Moore Search", 0, 0, matchIndices, N, M, 0);
     }

     long startTime = System.nanoTime();

     // Step 1: Preprocessing (Bad Character Rule)
     long preprocessStartTime = System.nanoTime();
     int[] badChar = buildBadCharTable(pattern);
     long preprocessEndTime = System.nanoTime();
     // NEW: Calculate preprocessing overhead time
     long overheadNs = preprocessEndTime - preprocessStartTime;


     int s = 0; // s is the shift
     
     // Step 2: Searching
     while (s <= (N - M)) {
         int j = M - 1; 

         // Keep reducing index j while characters of pattern and text are matching
         while (j >= 0) {
             // NEW: Increment comparison count
             comparisonCount++; 
             if (pattern.charAt(j) != text.charAt(s + j)) {
                 break;
             }
             j--;
         }

         if (j < 0) {
             matchIndices.add(s);
             // Shift after a match (Good Suffix rule complexity avoided for simplicity)
             s += (s + M < N) ? M - badChar[text.charAt(s + M)] : 1;
         } else {
             // Shift using the Bad Character Rule
             s += Math.max(1, j - badChar[text.charAt(s + j)]);
         }
     }

     long endTime = System.nanoTime();
     long executionTimeNs = endTime - startTime;

     // NEW: Return overhead time and comparison count
     return new MatchResult("Boyer-Moore Search", executionTimeNs, overheadNs, matchIndices, N, M, comparisonCount);
 }
}